---
export const prerender = true;

import Layout from "../../layouts/Layout.astro";
import HeaderContainer from "../../components/HeaderContainer.astro";
import Footer from "../../components/footer.astro";
import WasapBall from "../../components/shareComponents/wasapBall.astro";
import ServiceContactForm from "../../components/ServiceContactForm.astro";
import StructuredData from "../../components/StructuredData.astro";
import SectionHero from "../../components/SectionHero.astro";
import { services } from "../../consts/services";
import { Icon } from "astro-icon/components";
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

// Generate Static Paths
export async function getStaticPaths() {
    return services.map((service) => ({
        params: { slug: service.id },
        props: { service },
    }));
}

const { service } = Astro.props;

// Map Service IDs to new English filenames
// Map Service IDs to filenames if they don't match the ID exactly
const imageMap: Record<string, string> = {
    "inspeccion-integridad-estructural": "inspeccion-integridad",
    "monitoreo-kpis-zarandas": "monitoreo-kpis",
};

const imageName = imageMap[service.id] || service.id;

// Dynamic Image Import
const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/services/*.{jpeg,jpg,png,gif}",
);
const imagePath = `/src/assets/services/${imageName}.png`;
if (!images[imagePath])
    throw new Error(
        `"${imagePath}" does not exist in glob: "src/assets/services/*.{jpeg,jpg,png,gif}"`,
    );
const imagePromise = await images[imagePath]();
const imageMetadata = imagePromise.default;

// SEO Meta Tags
const serviceDescription = `${service.shortDescription} ${service.fullDescription.substring(0, 150)}...`;
const serviceKeywords = `${service.title}, ${service.features.join(", ")}, mantenimiento predictivo, cusco, peru`;

// Schema.org Service Data
const serviceSchemaData = {
    name: service.title,
    title: service.title,
    description: serviceDescription,
    fullDescription: service.fullDescription,
    features: service.features,
};
---

<Layout
    title={`${service.title} | MBC`}
    description={serviceDescription}
    image={`/services/${imageName}.png`}
>
    <!-- Service Schema.org -->
    <StructuredData type="service" data={serviceSchemaData} />

    <SectionHero
        title={service.title}
        subtitle={service.shortDescription}
        image={imageMetadata}
        breadcrumbItems={[
            { name: "Inicio", href: "/" },
            { name: "Servicios", href: "/services" },
            {
                name: service.title,
                href: `/servicios/${service.id}`,
                current: true,
            },
        ]}
    />

    <!-- Main Content Grid -->
    <div class="relative bg-[#08080A] min-h-screen">
        <!-- Background Pattern -->
        <div
            class="absolute inset-0 z-0 pointer-events-none opacity-20"
            style="background-image: radial-gradient(#31B0FF 1px, transparent 1px); background-size: 40px 40px;"
        >
        </div>

        <div class="container mx-auto px-4 py-16 max-w-7xl relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <!-- Left: Content & Benefits (2 Cols) -->
                <div class="lg:col-span-2 space-y-12">
                    <!-- Description -->
                    <section>
                        <h2
                            class="text-2xl font-bold text-white mb-6 flex items-center gap-3"
                        >
                            <Icon
                                name="lucide:info"
                                class="w-6 h-6 text-[#31B0FF]"
                            />
                            Descripción del Servicio
                        </h2>
                        <p
                            class="text-gray-300 text-lg leading-relaxed text-justify"
                        >
                            {service.fullDescription}
                        </p>
                    </section>

                    <!-- Features/Capabilities -->
                    <section>
                        <h2
                            class="text-2xl font-bold text-white mb-6 flex items-center gap-3"
                        >
                            <Icon
                                name="lucide:layers"
                                class="w-6 h-6 text-[#31B0FF]"
                            />
                            Capacidades Técnicas
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {
                                service.features.map((feature) => (
                                    <div class="bg-[#11161d] p-4 rounded-lg border border-white/5 flex items-center gap-3 hover:border-[#31B0FF]/30 transition-colors">
                                        <Icon
                                            name="lucide:check-circle-2"
                                            class="w-5 h-5 text-[#31B0FF]"
                                        />
                                        <span class="text-gray-200">
                                            {feature}
                                        </span>
                                    </div>
                                ))
                            }
                        </div>
                    </section>

                    <!-- Benefits -->
                    <section>
                        <h2
                            class="text-2xl font-bold text-white mb-6 flex items-center gap-3"
                        >
                            <Icon
                                name="lucide:trending-up"
                                class="w-6 h-6 text-[#31B0FF]"
                            />
                            Beneficios Clave
                        </h2>
                        <ul class="space-y-4">
                            {
                                service.benefits.map((benefit) => (
                                    <li class="flex items-start gap-4">
                                        <div class="w-8 h-8 rounded-full bg-[#31B0FF]/10 flex items-center justify-center shrink-0 mt-1">
                                            <Icon
                                                name="lucide:plus"
                                                class="w-5 h-5 text-[#31B0FF]"
                                            />
                                        </div>
                                        <p class="text-gray-300 text-lg">
                                            {benefit}
                                        </p>
                                    </li>
                                ))
                            }
                        </ul>
                    </section>
                </div>

                <!-- Right: Contact Form (1 Col) -->
                <div class="lg:col-span-1">
                    <div class="sticky top-24">
                        <ServiceContactForm serviceName={service.title} />
                    </div>
                </div>
            </div>
        </div>
    </div>
</Layout>

<style>
    @keyframes hero-move-scale {
        0% {
            transform: scale(1.1);
        }
        100% {
            transform: scale(1);
        }
    }

    @keyframes blur-up {
        0% {
            opacity: 0;
            transform: translateY(30px);
            filter: blur(10px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
            filter: blur(0);
        }
    }

    @keyframes grow-line {
        0% {
            width: 0;
            opacity: 0;
        }
        100% {
            width: 6rem; /* w-24 */
            opacity: 0.8;
        }
    }

    .animate-hero-bg {
        animation: hero-move-scale 20s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        will-change: transform;
    }

    .animate-blur-up {
        animation: blur-up 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        will-change: opacity, transform, filter;
    }

    .animate-grow-line {
        animation: grow-line 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        will-change: width, opacity;
    }
</style>
