---
import AnimateItem from "../AnimateItem.astro";
import { Icon } from "astro-icon/components";
import logoAntamina from "../../assets/logo-antamina.jpg";
import logoAntapaccay from "../../assets/logo-antapacay.png";
import logoCerroVerde from "../../assets/logo-cerro-verde.jpg";
import logoSouthern from "../../assets/logo-souther.png";

const testimonials = [
    {
        text: "Logramos una reducción significativa en las paradas no planificadas, optimizando la producción y la eficiencia operativa en nuestras plantas de procesamiento.",
        company: "Antamina",
        source: "Compañía Minera Antamina",
        sourceUrl: "https://www.antamina.com/",
        logo: logoAntamina,
        impact: "Disponibilidad +15%"
    },
    {
        text: "El mantenimiento predictivo nos permitió extender la vida útil de nuestros equipos críticos en más de un 20%, reduciendo costos de capital a largo plazo.",
        company: "Antapaccay",
        source: "Compañía Minera Antapaccay",
        sourceUrl: "https://www.antapaccay.pe/",
        logo: logoAntapaccay,
        impact: "Vida Útil +20%"
    },
    {
        text: "Hemos reducido el tiempo de inactividad de los equipos en un 25% gracias a la monitorización y el análisis predictivo de fallas incipientes.",
        company: "Cerro Verde",
        source: "Sociedad Minera Cerro Verde",
        sourceUrl: "https://www.cerroverde.pe/",
        logo: logoCerroVerde,
        impact: "Inactividad -25%"
    },
    {
        text: "La implementación de estrategias predictivas ha disminuido nuestros costos de mantenimiento y mejorado la confiabilidad de la flota de transporte.",
        company: "Southern Perú",
        source: "Southern Peru Copper Corp",
        sourceUrl: "https://southernperu.com/",
        logo: logoSouthern,
        impact: "Confiabilidad +30%"
    },
];
---

<section class="bg-background py-28 relative overflow-hidden">
    <!-- Background Decoration -->
    <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-brand/5 blur-[120px] rounded-full -translate-y-1/2 translate-x-1/2"></div>
    <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-brand/5 blur-[120px] rounded-full translate-y-1/2 -translate-x-1/2"></div>

    <div class="container mx-auto px-6 relative z-10">
        <div class="mb-20 text-center">
            <AnimateItem variant="fade-up" delay={0.1}>
                <span class="text-[#31B0FF] font-bold text-[10px] uppercase tracking-[0.5em] mb-4 block">Validación Operativa</span>
                <h2 class="text-4xl md:text-6xl font-black text-white mb-8 tracking-tighter">
                    CONFIANZA <span class="text-gray-500 italic">INDUSTRIAL</span>
                </h2>
                <div class="h-px w-24 bg-gradient-to-r from-transparent via-[#31B0FF]/40 to-transparent mx-auto"></div>
            </AnimateItem>
        </div>

        <AnimateItem variant="fade-up" delay={0.3} class="relative max-w-6xl mx-auto">
            <div class="overflow-hidden rounded-[2rem] bg-[#0d1117] border border-white/5 relative z-10 shadow-2xl">
                <!-- Decorative Elements -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-[#31B0FF]/5 blur-[80px] rounded-full pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-[#31B0FF]/5 blur-[80px] rounded-full pointer-events-none"></div>

                <div class="testimonial-track flex transition-transform duration-1000 cubic-bezier(0.2, 0.8, 0.2, 1)">
                    {testimonials.map((t) => (
                        <div class="testimonial-slide w-full flex-shrink-0 p-10 md:p-20 flex flex-col md:flex-row items-center gap-12 md:gap-24 relative overflow-hidden">
                            <!-- Logo Section -->
                            <div class="relative shrink-0 w-full md:w-1/3 flex flex-col items-center">
                                <div class="w-48 h-48 md:w-64 md:h-64 rounded-[2.5rem] bg-white flex items-center justify-center group/logo overflow-hidden relative transition-all duration-700 hover:scale-[1.02] shadow-2xl">
                                    <img
                                        src={t.logo.src}
                                        alt={`Logo de ${t.company}`}
                                        class="w-full h-full object-contain p-10 grayscale opacity-80 group-hover/logo:grayscale-0 group-hover/logo:opacity-100 transition-all duration-1000"
                                        loading="lazy"
                                    />
                                    <div class="absolute inset-0 bg-gradient-to-tr from-[#31B0FF]/5 to-transparent opacity-0 group-hover/logo:opacity-100 transition-opacity"></div>
                                </div>
                            </div>

                            <!-- Content Section -->
                            <div class="text-center md:text-left flex-1 relative">
                                <div class="absolute -top-12 -left-8 text-white/5 pointer-events-none">
                                    <Icon name="lucide:quote" class="w-32 h-32" />
                                </div>
                                
                                <p class="text-xl md:text-3xl text-gray-200 font-light leading-relaxed mb-12 relative z-10 tracking-tight">
                                    "{t.text}"
                                </p>
                                
                                <div class="flex flex-col gap-8 relative z-10">
                                    <div class="h-px w-16 bg-[#31B0FF]/40"></div>
                                    
                                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-8">
                                        <div>
                                            <h4 class="text-white font-black text-3xl mb-3 tracking-tighter">
                                                {t.source}
                                            </h4>
                                            <a
                                                href={t.sourceUrl}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                class="inline-flex items-center gap-3 text-gray-500 hover:text-[#31B0FF] transition-all text-xs font-bold uppercase tracking-widest group/link"
                                            >
                                                <span>Portal Corporativo</span>
                                                <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center group-hover/link:bg-[#31B0FF] group-hover/link:text-white transition-all">
                                                    <Icon name="lucide:arrow-right" class="w-3 h-3" />
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="absolute top-1/2 -left-6 md:-left-20 -translate-y-1/2 z-20">
                <button class="test-prev w-12 h-12 md:w-16 md:h-16 rounded-2xl bg-[#0d1117] border border-white/5 text-gray-500 hover:border-[#31B0FF] hover:text-[#31B0FF] transition-all flex items-center justify-center group shadow-2xl btn-glow">
                    <Icon name="lucide:chevron-left" class="w-8 h-8 group-hover:-translate-x-1 transition-transform" />
                </button>
            </div>
            <div class="absolute top-1/2 -right-6 md:-right-20 -translate-y-1/2 z-20">
                <button class="test-next w-12 h-12 md:w-16 md:h-16 rounded-2xl bg-[#0d1117] border border-white/5 text-gray-500 hover:border-[#31B0FF] hover:text-[#31B0FF] transition-all flex items-center justify-center group shadow-2xl btn-glow">
                    <Icon name="lucide:chevron-right" class="w-8 h-8 group-hover:translate-x-1 transition-transform" />
                </button>
            </div>

            <!-- Modern Pagination -->
            <div class="flex justify-center items-center gap-4 mt-16">
                <div class="h-px w-12 bg-white/5"></div>
                <div class="flex gap-3">
                    {testimonials.map((_, i) => (
                        <button
                            class="test-dot h-1.5 rounded-full transition-all duration-700"
                            data-index={i}
                            aria-label={`Testimonio ${i + 1}`}
                        />
                    ))}
                </div>
                <div class="h-px w-12 bg-white/5"></div>
            </div>
        </AnimateItem>
    </div>
</section>

<script>
    function initTestimonialSlider() {
        const track = document.querySelector(".testimonial-track");
        const slides = document.querySelectorAll(".testimonial-slide");
        const nextBtn = document.querySelector(".test-next");
        const prevBtn = document.querySelector(".test-prev");
        const dots = document.querySelectorAll(".test-dot");

        if (!track || slides.length === 0) return;

        let currentIndex = 0;
        let slideInterval: any;

        const updateSlide = (index: number) => {
            currentIndex = index;
            if (track instanceof HTMLElement)
                track.style.transform = `translateX(-${currentIndex * 100}%)`;

            dots.forEach((dot, i) => {
                if (i === currentIndex) {
                    dot.classList.add("bg-[#31B0FF]", "w-12");
                    dot.classList.remove("bg-white/10", "w-6");
                } else {
                    dot.classList.remove("bg-[#31B0FF]", "w-12");
                    dot.classList.add("bg-white/10", "w-6");
                }
            });
        };

        const startSlider = () => {
            slideInterval = setInterval(() => {
                const nextIndex = (currentIndex + 1) % slides.length;
                updateSlide(nextIndex);
            }, 8000);
        };

        const stopSlider = () => clearInterval(slideInterval);

        const handleInteraction = (action: () => void) => {
            stopSlider();
            action();
            startSlider();
        };

        nextBtn?.addEventListener("click", () =>
            handleInteraction(() => {
                const nextIndex = (currentIndex + 1) % slides.length;
                updateSlide(nextIndex);
            })
        );

        prevBtn?.addEventListener("click", () =>
            handleInteraction(() => {
                const prevIndex = (currentIndex - 1 + slides.length) % slides.length;
                updateSlide(prevIndex);
            })
        );

        dots.forEach((dot, i) => {
            dot.addEventListener("click", () =>
                handleInteraction(() => updateSlide(i))
            );
        });

        // Initialize
        updateSlide(0);
        startSlider();

        // Pause on hover
        track.addEventListener('mouseenter', stopSlider);
        track.addEventListener('mouseleave', startSlider);
    }

    document.addEventListener("DOMContentLoaded", initTestimonialSlider);
    document.addEventListener("astro:page-load", initTestimonialSlider);
</script>
