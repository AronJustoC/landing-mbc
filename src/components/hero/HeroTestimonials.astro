---
import { Icon } from "astro-icon/components";
import logoAntamina from "../../assets/logo-antamina.jpg";
import logoAntapaccay from "../../assets/logo-antapacay.png";
import logoCerroVerde from "../../assets/logo-cerro-verde.jpg";
import logoSouthern from "../../assets/logo-souther.png";

const testimonials = [
    {
        text: "Logramos una reducción significativa en las paradas no planificadas, optimizando la producción y la eficiencia operativa en nuestras plantas de procesamiento.",
        company: "Antamina",
        source: "Compañía Minera Antamina",
        sourceUrl: "https://www.antamina.com/",
        logo: logoAntamina,
        impact: "Disponibilidad +15%"
    },
    {
        text: "El mantenimiento predictivo nos permitió extender la vida útil de nuestros equipos críticos en más de un 20%, reduciendo costos de capital a largo plazo.",
        company: "Antapaccay",
        source: "Compañía Minera Antapaccay",
        sourceUrl: "https://www.antapaccay.pe/",
        logo: logoAntapaccay,
        impact: "Vida Útil +20%"
    },
    {
        text: "Hemos reducido el tiempo de inactividad de los equipos en un 25% gracias a la monitorización y el análisis predictivo de fallas incipientes.",
        company: "Cerro Verde",
        source: "Sociedad Minera Cerro Verde",
        sourceUrl: "https://www.cerroverde.pe/",
        logo: logoCerroVerde,
        impact: "Inactividad -25%"
    },
    {
        text: "La implementación de estrategias predictivas ha disminuido nuestros costos de mantenimiento y mejorado la confiabilidad de la flota de transporte.",
        company: "Southern Perú",
        source: "Southern Peru Copper Corp",
        sourceUrl: "https://southernperu.com/",
        logo: logoSouthern,
        impact: "Confiabilidad +30%"
    },
];
---

<section class="reveal-section bg-[#08080A] py-32 relative overflow-hidden">
    <!-- Background Decoration -->
    <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-cyan-500/5 blur-[120px] rounded-full -translate-y-1/2 translate-x-1/2"></div>
    <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-blue-500/5 blur-[120px] rounded-full translate-y-1/2 -translate-x-1/2"></div>

    <div class="container mx-auto px-6 relative z-10">
        <div class="mb-16 text-center animate-item">
            <span class="text-cyan-400 font-semibold text-xs uppercase tracking-[0.3em] mb-4 block">Presencia Estratégica</span>
            <h2 class="text-3xl md:text-5xl font-bold text-white mb-6 tracking-tight">
                Confianza en la <span class="text-gray-500">Industria</span>
            </h2>
            <div class="h-px w-20 bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent mx-auto"></div>
        </div>

        <div class="animate-item relative max-w-5xl mx-auto">
            <div class="overflow-hidden rounded-3xl bg-[#0d1117] border border-white/5 relative z-10 shadow-2xl">
                <div class="testimonial-track flex transition-transform duration-1000 cubic-bezier(0.2, 0.8, 0.2, 1)">
                    {testimonials.map((t) => (
                        <div class="testimonial-slide w-full flex-shrink-0 p-8 md:p-16 flex flex-col md:flex-row items-center gap-12 md:gap-20">
                            <!-- Logo & Impact Section -->
                            <div class="relative shrink-0 flex flex-col items-center gap-6">
                                <div class="w-40 h-40 md:w-48 md:h-48 rounded-2xl bg-white p-6 shadow-[0_0_40px_rgba(6,182,212,0.1)] flex items-center justify-center group overflow-hidden relative">
                                    <img
                                        src={t.logo.src}
                                        alt={`Logo de ${t.company}`}
                                        class="w-full h-full object-contain grayscale hover:grayscale-0 transition-all duration-700"
                                        loading="lazy"
                                    />
                                    <div class="absolute inset-0 bg-gradient-to-tr from-cyan-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                </div>
                                
                                <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-cyan-500/10 border border-cyan-500/20 text-cyan-400 text-xs font-bold uppercase tracking-widest">
                                    <span class="relative flex h-2 w-2">
                                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
                                        <span class="relative inline-flex rounded-full h-2 w-2 bg-cyan-500"></span>
                                    </span>
                                    {t.impact}
                                </div>
                            </div>

                            <!-- Content Section -->
                            <div class="text-center md:text-left flex-1">
                                <div class="mb-6 flex justify-center md:justify-start">
                                    <Icon name="lucide:quote" class="w-10 h-10 text-cyan-500/20" />
                                </div>
                                
                                <p class="text-xl md:text-2xl text-gray-200 font-light leading-relaxed mb-8 italic">
                                    "{t.text}"
                                </p>
                                
                                <div class="h-px w-20 bg-gradient-to-r from-cyan-500 to-transparent mb-6 mx-auto md:ml-0"></div>
                                
                                <div>
                                    <h4 class="text-white font-bold text-xl mb-3 tracking-wide">
                                        {t.source}
                                    </h4>
                                    <a
                                        href={t.sourceUrl}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="inline-flex items-center gap-2 text-cyan-400 hover:text-white transition-all text-sm font-semibold group/link"
                                    >
                                        Conocer más
                                        <Icon name="lucide:external-link" class="w-4 h-4 transition-transform group-hover/link:-translate-y-0.5 group-hover/link:translate-x-0.5" />
                                    </a>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            <!-- Navigation Buttons -->
            <button class="test-prev absolute top-1/2 -left-5 md:-left-20 -translate-y-1/2 w-12 h-12 md:w-14 md:h-14 rounded-full bg-[#121214] border border-gray-800 text-white hover:border-cyan-500 hover:text-cyan-400 transition-all z-20 flex items-center justify-center group shadow-xl">
                <Icon name="lucide:arrow-left" class="w-6 h-6 group-hover:-translate-x-1 transition-transform" />
            </button>
            <button class="test-next absolute top-1/2 -right-5 md:-right-20 -translate-y-1/2 w-12 h-12 md:w-14 md:h-14 rounded-full bg-[#121214] border border-gray-800 text-white hover:border-cyan-500 hover:text-cyan-400 transition-all z-20 flex items-center justify-center group shadow-xl">
                <Icon name="lucide:arrow-right" class="w-6 h-6 group-hover:translate-x-1 transition-transform" />
            </button>

            <!-- Dots Indicators -->
            <div class="flex justify-center gap-4 mt-12">
                {testimonials.map((_, i) => (
                    <button
                        class="test-dot h-1.5 rounded-full bg-gray-800 hover:bg-cyan-500/50 transition-all duration-300"
                        data-index={i}
                        aria-label={`Ir a testimonio ${i + 1}`}
                    />
                ))}
            </div>
        </div>
    </div>
</section>

<script>
    function initTestimonialSlider() {
        const track = document.querySelector(".testimonial-track");
        const slides = document.querySelectorAll(".testimonial-slide");
        const nextBtn = document.querySelector(".test-next");
        const prevBtn = document.querySelector(".test-prev");
        const dots = document.querySelectorAll(".test-dot");

        if (!track || slides.length === 0) return;

        let currentIndex = 0;
        let slideInterval: any;

        const updateSlide = (index: number) => {
            currentIndex = index;
            if (track instanceof HTMLElement)
                track.style.transform = `translateX(-${currentIndex * 100}%)`;

            dots.forEach((dot, i) => {
                if (i === currentIndex) {
                    dot.classList.add("bg-cyan-400", "w-12");
                    dot.classList.remove("bg-gray-800", "w-6");
                } else {
                    dot.classList.remove("bg-cyan-400", "w-12");
                    dot.classList.add("bg-gray-800", "w-6");
                }
            });
        };

        const startSlider = () => {
            slideInterval = setInterval(() => {
                const nextIndex = (currentIndex + 1) % slides.length;
                updateSlide(nextIndex);
            }, 8000);
        };

        const stopSlider = () => clearInterval(slideInterval);

        const handleInteraction = (action: () => void) => {
            stopSlider();
            action();
            startSlider();
        };

        nextBtn?.addEventListener("click", () =>
            handleInteraction(() => {
                const nextIndex = (currentIndex + 1) % slides.length;
                updateSlide(nextIndex);
            })
        );

        prevBtn?.addEventListener("click", () =>
            handleInteraction(() => {
                const prevIndex = (currentIndex - 1 + slides.length) % slides.length;
                updateSlide(prevIndex);
            })
        );

        dots.forEach((dot, i) => {
            dot.addEventListener("click", () =>
                handleInteraction(() => updateSlide(i))
            );
        });

        // Initialize
        updateSlide(0);
        startSlider();

        // Pause on hover
        track.addEventListener('mouseenter', stopSlider);
        track.addEventListener('mouseleave', startSlider);
    }

    document.addEventListener("DOMContentLoaded", initTestimonialSlider);
    document.addEventListener("astro:page-load", initTestimonialSlider);
</script>
