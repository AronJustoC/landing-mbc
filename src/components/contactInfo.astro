---
import { Icon } from "astro-icon/components";
import contactBg from "../assets/gruaGlobal.jpg";
import MapLocation from "./shareComponents/mapLocation.astro";
---

<section
  class="relative bg-gradient-to-br from-[#0a0a0c] via-[#0f1419] to-[#1a1f2e] pt-40 pb-20 overflow-hidden"
  id="contacto"
>
  <!-- Background Image with Heavy Overlay -->
  <div class="absolute inset-0 z-0 pointer-events-none">
    <img
      src={contactBg.src}
      alt="Industrial Background - Grúa Global"
      class="h-full w-full object-cover object-center opacity-100 brightness-120 contrast-130 scale-x-[-1]"
    />
    <!-- Overlay degradado para integrar la imagen oscura con el tema pero dejando ver detalles -->
    <div
      class="absolute inset-0 bg-gradient-to-t from-[#0a0a0c]/95 via-[#0a0a0c]/90 to-[#0a0a0c]/60 mix-blend-multiply"
    >
    </div>
    <div class="absolute inset-0 bg-[#0a0a0c]/40"></div>
  </div>

  <div class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-start">
      <!-- Columna Izquierda: Información de Contacto -->
      <div class="flex flex-col h-full">
        <div class="mb-12">
          <h2
            class="text-2xl lg:text-3xl font-semibold text-white tracking-tight leading-tight mb-6"
          >
            Contáctanos
          </h2>
          <!-- Decoración: Línea degradada -->
          <div
            class="h-1.5 w-24 bg-gradient-to-r from-cyan-400 to-blue-600 rounded-full mb-8"
          >
          </div>

          <p
            class="text-lg text-gray-400 leading-relaxed border-l-2 border-cyan-500/30 pl-6 max-w-lg"
          >
            Ponemos a tu disposición nuestros datos de contacto para que puedas
            comunicarte con nosotros de manera rápida y sencilla.
          </p>
        </div>

        <!-- Lista de Contacto -->
        <div class="space-y-10 flex-grow">
          <!-- Dirección -->
          <div class="flex items-start gap-6 group">
            <div
              class="flex-shrink-0 w-14 h-14 rounded-xl bg-gray-900/80 flex items-center justify-center text-cyan-400 border border-white/5 group-hover:border-cyan-500/50 group-hover:shadow-[0_0_20px_rgba(6,182,212,0.15)] transition-all duration-300"
            >
              <Icon name="lucide:map-pin" class="w-7 h-7" />
            </div>
            <div>
              <p
                class="text-xs text-cyan-500 font-bold uppercase tracking-widest mb-2"
              >
                Oficina Central
              </p>
              <p class="text-gray-200 text-lg sm:text-lg font-light">
                Calle Plateros 330, Cusco - Perú
              </p>
            </div>
          </div>

          <!-- Email -->
          <div class="flex items-start gap-6 group">
            <div
              class="flex-shrink-0 w-14 h-14 rounded-xl bg-gray-900/80 flex items-center justify-center text-cyan-400 border border-white/5 group-hover:border-cyan-500/50 group-hover:shadow-[0_0_20px_rgba(6,182,212,0.15)] transition-all duration-300"
            >
              <Icon name="lucide:mail" class="w-7 h-7" />
            </div>
            <div>
              <p
                class="text-xs text-cyan-500 font-bold uppercase tracking-widest mb-2"
              >
                Consultas Generales
              </p>
              <a
                href="mailto:gerencia@mbc.pe"
                class="text-gray-200 text-lg sm:text-lg font-light hover:text-cyan-400 transition-colors"
              >
                gerencia@mbc.pe
              </a>
            </div>
          </div>

          <!-- Teléfono -->
          <div class="flex items-start gap-6 group">
            <div
              class="flex-shrink-0 w-14 h-14 rounded-xl bg-gray-900/80 flex items-center justify-center text-cyan-400 border border-white/5 group-hover:border-cyan-500/50 group-hover:shadow-[0_0_20px_rgba(6,182,212,0.15)] transition-all duration-300"
            >
              <Icon name="lucide:phone" class="w-7 h-7" />
            </div>
            <div>
              <p
                class="text-xs text-cyan-500 font-bold uppercase tracking-widest mb-2"
              >
                Teléfonos
              </p>
              <a
                href="tel:+51921005260"
                class="text-gray-200 text-lg sm:text-lg font-light hover:text-cyan-400 transition-colors block"
              >
                (+51) 921 005 260
              </a>
            </div>
          </div>
        </div>

        <!-- Redes y Mapa -->
        <div class="mt-8 space-y-10">
          <div>
            <h3
              class="text-gray-500 text-xs font-bold uppercase tracking-widest mb-4"
            >
              Mantenerse en contacto
            </h3>
            <div class="flex gap-4">
              <a
                href="#"
                class="w-10 h-10 rounded-lg bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-cyan-600 hover:border-cyan-500 transition-all hover:-translate-y-1"
              >
                <Icon name="lucide:facebook" class="w-5 h-5" />
              </a>
              <a
                href="#"
                class="w-10 h-10 rounded-lg bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-cyan-600 hover:border-cyan-500 transition-all hover:-translate-y-1"
              >
                <Icon name="lucide:instagram" class="w-5 h-5" />
              </a>
              <a
                href="#"
                class="w-10 h-10 rounded-lg bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-cyan-600 hover:border-cyan-500 transition-all hover:-translate-y-1"
              >
                <Icon name="lucide:linkedin" class="w-5 h-5" />
              </a>
            </div>
          </div>

          <!-- Mapa Integrado -->
          <div
            class="w-full h-48 rounded-xl overflow-hidden shadow-2xl border border-white/10 relative group"
          >
            <MapLocation />
          </div>
        </div>
      </div>

      <!-- Columna Derecha: Formulario -->
      <div
        class="bg-[#0f1419]/80 backdrop-blur-xl border border-white/10 rounded-3xl shadow-[0_0_60px_rgba(0,0,0,0.6)] p-8 lg:p-12 md:mt-12 relative overflow-hidden"
      >
        <!-- Decoración fondo -->
        <div
          class="absolute top-0 right-0 w-64 h-64 bg-cyan-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"
        >
        </div>

        <h3 class="text-3xl font-bold text-white mb-3 relative z-10">
          ¿Tienes Preguntas?
        </h3>
        <p class="text-gray-400 mb-10 relative z-10">
          Déjanos un mensaje y pronto nos pondremos en contacto contigo.
        </p>

        <form
          id="contact-form"
          class="space-y-6 relative z-10"
          method="post"
          action="#"
          novalidate
        >
          <!-- Campo Nombres -->
          <div class="group relative">
            <input
              type="text"
              name="nombre"
              id="nombre"
              class="peer w-full bg-[#1a1f2e] border border-gray-700/50 px-5 pt-6 pb-2 rounded-xl text-white focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 placeholder:text-transparent transition-all"
              placeholder=" "
              required
            />
            <label
              for="nombre"
              class="absolute left-5 top-2 text-gray-400 text-xs transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-4 peer-focus:top-2 peer-focus:text-cyan-500 peer-focus:text-xs pointer-events-none"
            >
              Nombres y Apellidos
            </label>
            <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
              >⚠ El nombre es requerido</span
            >
          </div>

          <!-- Campo Empresa (Opcional) -->
          <div class="group relative">
            <input
              type="text"
              name="empresa"
              id="empresa"
              class="peer w-full bg-[#1a1f2e] border border-gray-700/50 px-5 pt-6 pb-2 rounded-xl text-white focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 placeholder:text-transparent transition-all"
              placeholder=" "
            />
            <label
              for="empresa"
              class="absolute left-5 top-2 text-gray-400 text-xs transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-4 peer-focus:top-2 peer-focus:text-cyan-500 peer-focus:text-xs pointer-events-none"
            >
              Empresa (Opcional)
            </label>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Campo Email -->
            <div class="group relative">
              <input
                type="email"
                name="email"
                id="email"
                class="peer w-full bg-[#1a1f2e] border border-gray-700/50 px-5 pt-6 pb-2 rounded-xl text-white focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 placeholder:text-transparent transition-all"
                placeholder=" "
                required
              />
              <label
                for="email"
                class="absolute left-5 top-2 text-gray-400 text-xs transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-4 peer-focus:top-2 peer-focus:text-cyan-500 peer-focus:text-xs pointer-events-none"
              >
                Correo Electrónico
              </label>
              <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
                >⚠ Email inválido</span
              >
            </div>

            <!-- Campo Teléfono -->
            <div class="group relative">
              <input
                type="tel"
                name="telefono"
                id="telefono"
                class="peer w-full bg-[#1a1f2e] border border-gray-700/50 px-5 pt-6 pb-2 rounded-xl text-white focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 placeholder:text-transparent transition-all"
                placeholder=" "
                required
              />
              <label
                for="telefono"
                class="absolute left-5 top-2 text-gray-400 text-xs transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-4 peer-focus:top-2 peer-focus:text-cyan-500 peer-focus:text-xs pointer-events-none"
              >
                Teléfono
              </label>
              <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
                >⚠ Teléfono requerido</span
              >
            </div>
          </div>

          <!-- Campo Mensaje -->
          <div class="group relative">
            <textarea
              name="mensaje"
              id="mensaje"
              rows="4"
              class="peer w-full bg-[#1a1f2e] border border-gray-700/50 px-5 pt-6 pb-2 rounded-xl text-white focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 placeholder:text-transparent transition-all resize-none"
              placeholder=" "
              required></textarea>
            <label
              for="mensaje"
              class="absolute left-5 top-2 text-gray-400 text-xs transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-4 peer-focus:top-2 peer-focus:text-cyan-500 peer-focus:text-xs pointer-events-none"
            >
              Mensaje
            </label>
            <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
              >⚠ Escribe tu mensaje</span
            >
          </div>

          <!-- Google reCAPTCHA -->
          <div class="flex justify-start transform origin-left md:scale-95">
            <div
              class="g-recaptcha"
              data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"
              data-theme="dark"
            >
            </div>
          </div>
          <div
            id="captcha-error"
            class="hidden text-red-400 text-sm font-bold flex items-center gap-2 mt-2"
          >
            <Icon name="lucide:alert-circle" class="w-4 h-4" />
            <span>Por favor, verifica que no eres un robot.</span>
          </div>

          <!-- Botón de Envío -->
          <div class="pt-4">
            <button
              type="submit"
              class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-4 px-10 rounded-xl shadow-[0_0_20px_rgba(6,182,212,0.3)] hover:shadow-[0_0_35px_rgba(6,182,212,0.5)] transition-all duration-300 transform hover:-translate-y-1 flex justify-center items-center gap-3"
            >
              <span>ENVIAR MENSAJE</span>
              <Icon name="lucide:send" class="w-5 h-5" />
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div
    id="notification-toast"
    class="fixed top-24 right-4 z-[100] translate-x-full opacity-0 transition-all duration-500 ease-in-out pointer-events-none"
  >
    <div
      class="bg-[#0f1419] border-l-4 border-cyan-500 rounded-lg shadow-[0_0_20px_rgba(0,0,0,0.5)] p-4 pr-10 flex items-center gap-4 min-w-[300px]"
    >
      <div
        class="w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-400 shrink-0"
      >
        <Icon name="lucide:check-circle" class="w-6 h-6" />
      </div>
      <div>
        <h4 class="text-white font-bold text-sm">¡Mensaje Enviado!</h4>
        <p class="text-gray-400 text-xs mt-1">
          Nos pondremos en contacto pronto.
        </p>
      </div>
    </div>
  </div>

  <!-- Scripts Lógica de Validación -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("contact-form");
      const errorMsg = document.getElementById("captcha-error");
      const toast = document.getElementById("notification-toast");

      // Función para mostrar Toast
      const showToast = () => {
        if (!toast) return;
        toast.classList.remove("translate-x-full", "opacity-0");
        setTimeout(() => {
          toast.classList.add("translate-x-full", "opacity-0");
        }, 5000); // 5 segundos
      };

      // Validación de campos simple
      const validateField = (input) => {
        const group = input.closest(".group");
        const errorSpan = group.querySelector(".error-msg");
        let isValid = true;

        if (input.hasAttribute("required") && !input.value.trim()) {
          isValid = false;
        }
        if (input.type === "email" && input.value) {
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(input.value)) isValid = false;
        }

        if (!isValid) {
          input.classList.add(
            "border-red-500",
            "focus:border-red-500",
            "focus:ring-red-500",
          );
          input.classList.remove(
            "border-gray-700/50",
            "focus:border-cyan-500",
            "focus:ring-cyan-500",
          );
          if (errorSpan) errorSpan.classList.remove("hidden");
        } else {
          input.classList.remove(
            "border-red-500",
            "focus:border-red-500",
            "focus:ring-red-500",
          );
          input.classList.add(
            "border-gray-700/50",
            "focus:border-cyan-500",
            "focus:ring-cyan-500",
          );
          if (errorSpan) errorSpan.classList.add("hidden");
        }
        return isValid;
      };

      // Listeners para validación en tiempo real (al salir del campo)
      const inputs = form?.querySelectorAll("input, textarea");
      inputs?.forEach((input) => {
        input.addEventListener("blur", () => validateField(input));
        input.addEventListener("input", () => {
          // Limpiar error al escribir
          const group = input.closest(".group");
          const errorSpan = group.querySelector(".error-msg");
          if (input.classList.contains("border-red-500")) {
            input.classList.remove(
              "border-red-500",
              "focus:border-red-500",
              "focus:ring-red-500",
            );
            input.classList.add(
              "border-gray-700/50",
              "focus:border-cyan-500",
              "focus:ring-cyan-500",
            );
            if (errorSpan) errorSpan.classList.add("hidden");
          }
        });
      });

      if (form) {
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          let isFormValid = true;

          // Validar todos los campos
          inputs?.forEach((input) => {
            if (!validateField(input)) isFormValid = false;
          });

          // Validar Captcha
          // @ts-ignore
          const response = grecaptcha.getResponse();
          if (response.length === 0) {
            isFormValid = false;
            if (errorMsg) errorMsg.classList.remove("hidden");
          } else {
            if (errorMsg) errorMsg.classList.add("hidden");
          }

          if (isFormValid) {
            // Simulación de envío
            console.log("Formulario válido, enviando...");
            showToast(); // Mostrar notificación en lugar de alert
            form.reset();
            // @ts-ignore
            grecaptcha.reset();
          }
        });
      }
    });
  </script>
</section>
