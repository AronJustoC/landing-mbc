---
import { Icon } from "astro-icon/components";

import MapLocation from "./shareComponents/mapLocation.astro";
---

<section
  class="relative min-h-screen flex items-center bg-gradient-to-br from-[#08080A] via-[#0d1216] to-[#151922] pt-20 overflow-hidden"
  id="contacto"
>
  <!-- Background Solid Color -->
  <div class="absolute inset-0 z-0 bg-[#08080A]"></div>

  <div class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
      <!-- Columna Izquierda: Información de Contacto -->
      <div class="flex flex-col h-full">
        <div class="mb-8">
          <h2
            class="text-xl lg:text-2xl font-semibold text-white tracking-tight leading-tight mb-4"
          >
            Contáctanos
          </h2>
          <!-- Decoración: Línea degradada -->
          <div
            class="h-1 w-20 bg-gradient-to-r from-teal-400 to-indigo-600 rounded-full mb-6"
          >
          </div>

          <p
            class="text-base text-gray-400 leading-relaxed border-l-2 border-teal-500/30 pl-4 max-w-lg"
          >
            Ponemos a tu disposición nuestros datos de contacto para que puedas
            comunicarte con nosotros de manera rápida y sencilla.
          </p>
        </div>

        <!-- Lista de Contacto -->
        <div class="space-y-6 flex-grow">
          <!-- Dirección -->
          <div class="flex items-start gap-4 group">
            <div
              class="flex-shrink-0 w-12 h-12 rounded-lg bg-gray-900/80 flex items-center justify-center text-teal-400 border border-white/5 group-hover:border-teal-500/50 group-hover:shadow-[0_0_15px_rgba(20,184,166,0.15)] transition-all duration-300"
            >
              <Icon name="lucide:map-pin" class="w-6 h-6" />
            </div>
            <div>
              <p
                class="text-xs text-teal-500 font-bold uppercase tracking-widest mb-1"
              >
                Oficina Central
              </p>
              <p class="text-gray-200 text-base font-light">
                Calle Plateros 330, Cusco - Perú
              </p>
            </div>
          </div>

          <!-- Email -->
          <div class="flex items-start gap-4 group">
            <div
              class="flex-shrink-0 w-12 h-12 rounded-lg bg-gray-900/80 flex items-center justify-center text-teal-400 border border-white/5 group-hover:border-teal-500/50 group-hover:shadow-[0_0_15px_rgba(20,184,166,0.15)] transition-all duration-300"
            >
              <Icon name="lucide:mail" class="w-6 h-6" />
            </div>
            <div>
              <p
                class="text-xs text-teal-500 font-bold uppercase tracking-widest mb-1"
              >
                Consultas Generales
              </p>
              <a
                href="mailto:gerencia@mbc.pe"
                class="text-gray-200 text-base font-light hover:text-teal-400 transition-colors"
              >
                info@mbcpredictive.com
              </a>
            </div>
          </div>

          <!-- Teléfono -->
          <div class="flex items-start gap-4 group">
            <div
              class="flex-shrink-0 w-12 h-12 rounded-lg bg-gray-900/80 flex items-center justify-center text-teal-400 border border-white/5 group-hover:border-teal-500/50 group-hover:shadow-[0_0_15px_rgba(20,184,166,0.15)] transition-all duration-300"
            >
              <Icon name="lucide:phone" class="w-6 h-6" />
            </div>
            <div>
              <p
                class="text-xs text-teal-500 font-bold uppercase tracking-widest mb-1"
              >
                Teléfonos
              </p>
              <a
                href="tel:+51921005260"
                class="text-gray-200 text-base font-light hover:text-teal-400 transition-colors block"
              >
                (+51) 966 852 981 / (+51) 991 433 399
              </a>
            </div>
          </div>
        </div>

        <!-- Redes y Mapa -->
        <div class="mt-6 space-y-6">
          <div>
            <h3
              class="text-gray-500 text-xs font-bold uppercase tracking-widest mb-3"
            >
              Mantenerse en contacto
            </h3>
            <div class="flex gap-3">
              <a
                href="#"
                class="w-9 h-9 rounded-md bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-teal-600 hover:border-teal-500 transition-all hover:-translate-y-0.5"
              >
                <Icon name="lucide:facebook" class="w-4 h-4" />
              </a>
              <a
                href="#"
                class="w-9 h-9 rounded-md bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-teal-600 hover:border-teal-500 transition-all hover:-translate-y-0.5"
              >
                <Icon name="lucide:instagram" class="w-4 h-4" />
              </a>
              <a
                href="#"
                class="w-9 h-9 rounded-md bg-white/5 border border-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-teal-600 hover:border-teal-500 transition-all hover:-translate-y-0.5"
              >
                <Icon name="lucide:linkedin" class="w-4 h-4" />
              </a>
            </div>
          </div>

          <!-- Mapa Integrado -->
          <div
            class="w-full h-32 rounded-lg overflow-hidden shadow-2xl border border-white/10 relative group"
          >
            <MapLocation />
          </div>
        </div>
      </div>

      <!-- Columna Derecha: Formulario -->
      <div
        class="bg-[#0d1216]/80 backdrop-blur-xl border border-white/10 rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.6)] p-6 lg:p-8 relative overflow-hidden"
      >
        <!-- Decoración fondo -->
        <div
          class="absolute top-0 right-0 w-48 h-48 bg-teal-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"
        >
        </div>

        <h3 class="text-2xl font-bold text-white mb-2 relative z-10">
          ¿Tienes Preguntas?
        </h3>
        <p class="text-gray-400 text-sm mb-6 relative z-10">
          Déjanos un mensaje y pronto nos pondremos en contacto contigo.
        </p>

        <form
          id="contact-form"
          class="space-y-4 relative z-10"
          method="post"
          action="#"
          novalidate
        >
          <!-- Campo Nombres -->
          <div class="group relative">
            <input
              type="text"
              name="nombre"
              id="nombre"
              class="peer w-full bg-[#151922] border border-gray-700/50 px-4 pt-5 pb-1 rounded-lg text-white text-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 placeholder:text-transparent transition-all"
              placeholder=" "
              required
            />
            <label
              for="nombre"
              class="absolute left-4 top-1.5 text-gray-400 text-xs transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-3 peer-focus:top-1.5 peer-focus:text-teal-500 peer-focus:text-xs pointer-events-none"
            >
              Nombres y Apellidos
            </label>
            <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
              >⚠ El nombre es requerido</span
            >
          </div>

          <!-- Campo Empresa (Opcional) -->
          <div class="group relative">
            <input
              type="text"
              name="empresa"
              id="empresa"
              class="peer w-full bg-[#151922] border border-gray-700/50 px-4 pt-5 pb-1 rounded-lg text-white text-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 placeholder:text-transparent transition-all"
              placeholder=" "
            />
            <label
              for="empresa"
              class="absolute left-4 top-1.5 text-gray-400 text-xs transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-3 peer-focus:top-1.5 peer-focus:text-teal-500 peer-focus:text-xs pointer-events-none"
            >
              Empresa (Opcional)
            </label>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Campo Email -->
            <div class="group relative">
              <input
                type="email"
                name="email"
                id="email"
                class="peer w-full bg-[#151922] border border-gray-700/50 px-4 pt-5 pb-1 rounded-lg text-white text-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 placeholder:text-transparent transition-all"
                placeholder=" "
                required
              />
              <label
                for="email"
                class="absolute left-4 top-1.5 text-gray-400 text-xs transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-3 peer-focus:top-1.5 peer-focus:text-teal-500 peer-focus:text-xs pointer-events-none"
              >
                Correo Electrónico
              </label>
              <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
                >⚠ Email inválido</span
              >
            </div>

            <!-- Campo Teléfono -->
            <div class="group relative">
              <input
                type="tel"
                name="telefono"
                id="telefono"
                class="peer w-full bg-[#151922] border border-gray-700/50 px-4 pt-5 pb-1 rounded-lg text-white text-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 placeholder:text-transparent transition-all"
                placeholder=" "
                required
              />
              <label
                for="telefono"
                class="absolute left-4 top-1.5 text-gray-400 text-xs transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-3 peer-focus:top-1.5 peer-focus:text-teal-500 peer-focus:text-xs pointer-events-none"
              >
                Teléfono
              </label>
              <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
                >⚠ Teléfono requerido</span
              >
            </div>
          </div>

          <!-- Campo Mensaje -->
          <div class="group relative">
            <textarea
              name="mensaje"
              id="mensaje"
              rows="3"
              class="peer w-full bg-[#151922] border border-gray-700/50 px-4 pt-5 pb-1 rounded-lg text-white text-sm focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 placeholder:text-transparent transition-all resize-none"
              placeholder=" "
              required></textarea>
            <label
              for="mensaje"
              class="absolute left-4 top-1.5 text-gray-400 text-xs transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-gray-500 peer-placeholder-shown:top-3 peer-focus:top-1.5 peer-focus:text-teal-500 peer-focus:text-xs pointer-events-none"
            >
              Mensaje
            </label>
            <span class="error-msg hidden text-red-400 text-xs mt-1 ml-1"
              >⚠ Escribe tu mensaje</span
            >
          </div>

          <!-- Google reCAPTCHA -->
          <div
            class="flex justify-start transform origin-left scale-[0.85] md:scale-90"
          >
            <div
              class="g-recaptcha"
              data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"
              data-theme="dark"
            >
            </div>
          </div>
          <div
            id="captcha-error"
            class="hidden text-red-400 text-xs font-bold flex items-center gap-2 -mt-2"
          >
            <Icon name="lucide:alert-circle" class="w-4 h-4" />
            <span>Por favor, verifica que no eres un robot.</span>
          </div>

          <!-- Botón de Envío -->
          <div class="pt-2">
            <button
              type="submit"
              class="w-full bg-gradient-to-r from-teal-600 to-indigo-600 hover:from-teal-500 hover:to-indigo-500 text-white font-bold py-3 px-8 rounded-lg shadow-[0_0_15px_rgba(20,184,166,0.3)] hover:shadow-[0_0_25px_rgba(20,184,166,0.5)] transition-all duration-300 transform hover:-translate-y-0.5 flex justify-center items-center gap-2"
            >
              <span>ENVIAR MENSAJE</span>
              <Icon name="lucide:send" class="w-4 h-4" />
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div
    id="notification-toast"
    class="fixed top-24 right-4 z-[100] translate-x-full opacity-0 transition-all duration-500 ease-in-out pointer-events-none"
  >
    <div
      class="bg-[#0d1216] border-l-4 border-teal-500 rounded-lg shadow-[0_0_20px_rgba(0,0,0,0.5)] p-4 pr-10 flex items-center gap-4 min-w-[300px]"
    >
      <div
        class="w-10 h-10 rounded-full bg-teal-500/20 flex items-center justify-center text-teal-400 shrink-0"
      >
        <Icon name="lucide:check-circle" class="w-6 h-6" />
      </div>
      <div>
        <h4 class="text-white font-bold text-sm">¡Mensaje Enviado!</h4>
        <p class="text-gray-400 text-xs mt-1">
          Nos pondremos en contacto pronto.
        </p>
      </div>
    </div>
  </div>

  <!-- Scripts Lógica de Validación -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("contact-form");
      const errorMsg = document.getElementById("captcha-error");
      const toast = document.getElementById("notification-toast");

      // Función para mostrar Toast
      const showToast = () => {
        if (!toast) return;
        toast.classList.remove("translate-x-full", "opacity-0");
        setTimeout(() => {
          toast.classList.add("translate-x-full", "opacity-0");
        }, 5000); // 5 segundos
      };

      // Validación de campos simple
      const validateField = (input) => {
        const group = input.closest(".group");
        const errorSpan = group.querySelector(".error-msg");
        let isValid = true;

        if (input.hasAttribute("required") && !input.value.trim()) {
          isValid = false;
        }
        if (input.type === "email" && input.value) {
          const emailPattern = /^[^\s @]+ @[^\s @]+\.[^\s @]+$/;
          if (!emailPattern.test(input.value)) isValid = false;
        }

        if (!isValid) {
          input.classList.add(
            "border-red-500",
            "focus:border-red-500",
            "focus:ring-red-500",
          );
          input.classList.remove(
            "border-gray-700/50",
            "focus:border-teal-500",
            "focus:ring-teal-500",
          );
          if (errorSpan) errorSpan.classList.remove("hidden");
        } else {
          input.classList.remove(
            "border-red-500",
            "focus:border-red-500",
            "focus:ring-red-500",
          );
          input.classList.add(
            "border-gray-700/50",
            "focus:border-teal-500",
            "focus:ring-teal-500",
          );
          if (errorSpan) errorSpan.classList.add("hidden");
        }
        return isValid;
      };

      // Listeners para validación en tiempo real (al salir del campo)
      const inputs = form?.querySelectorAll("input, textarea");
      inputs?.forEach((input) => {
        input.addEventListener("blur", () => validateField(input));
        input.addEventListener("input", () => {
          // Limpiar error al escribir
          const group = input.closest(".group");
          const errorSpan = group.querySelector(".error-msg");
          if (input.classList.contains("border-red-500")) {
            input.classList.remove(
              "border-red-500",
              "focus:border-red-500",
              "focus:ring-red-500",
            );
            input.classList.add(
              "border-gray-700/50",
              "focus:border-teal-500",
              "focus:ring-teal-500",
            );
            if (errorSpan) errorSpan.classList.add("hidden");
          }
        });
      });

      if (form) {
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          let isFormValid = true;

          // Validar todos los campos
          inputs?.forEach((input) => {
            if (!validateField(input)) isFormValid = false;
          });

          // Validar Captcha
          // @ts-ignore
          const response = grecaptcha.getResponse();
          if (response.length === 0) {
            isFormValid = false;
            if (errorMsg) errorMsg.classList.remove("hidden");
          } else {
            if (errorMsg) errorMsg.classList.add("hidden");
          }

          if (isFormValid) {
            // Simulación de envío
            console.log("Formulario válido, enviando...");
            showToast(); // Mostrar notificación en lugar de alert
            form.reset();
            // @ts-ignore
            grecaptcha.reset();
          }
        });
      }
    });
  </script>
</section>